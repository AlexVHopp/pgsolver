ifneq ($(strip $(wildcard SatConfig)),)
	include SatConfig
endif


ifneq ($(strip $(PICOSAT)),)
	PICOSATFLAGS = -lflag `pwd`/_build/PicoSATWrap.o -lflag $(PICOSAT)/libpicosat.a
	PICOSATDEPS = _build/PicoSATWrap.o
endif

ifneq ($(strip $(ZCHAFF)),)
	ZCHAFFFLAGS = -lflag `pwd`/_build/zchaff_ocaml_wrapper.o -lflag $(ZCHAFF)/libsat.a
	ZCHAFFDEPS = _build/PicoSATWrap.o
endif

ifneq ($(strip $(MINISAT)),)
	MINISATFLAGS = -lflag `pwd`/_build/MiniSATWrap.o -lflag $(MINISAT)/simp/lib.a
	MINISATDEPS = _build/MiniSATWrap.o
endif

SATFLAGS = $(PICOSATFLAGS) $(ZCHAFFFLAGS) $(MINISATFLAGS)
SATDEPS = $(PICOSATDEPS) $(ZCHAFFDEPS) $(MINISATDEPS)


generatesat: $(SATDEPS)
	rm -f ./temp/generatedsat.ml
	echo "" > ./temp/generatedsat.ml
ifneq ($(strip $(PICOSAT)),)
	echo "open Picosat;;" >> ./temp/generatedsat.ml
	echo "open Picosatwrapper;;" >> ./temp/generatedsat.ml
endif
ifneq ($(strip $(ZCHAFF)),)
	echo "open Zchaff;;" >> ./temp/generatedsat.ml
	echo "open Zchaffwrapper;;" >> ./temp/generatedsat.ml
endif
ifneq ($(strip $(MINISAT)),)
	echo "open Minisat;;" >> ./temp/generatedsat.ml
	echo "open Minisatwrapper;;" >> ./temp/generatedsat.ml
endif

_build/PicoSATWrap.o:
	mkdir -p ./_build
	gcc -c -g -I `ocamlfind printconf stdlib` -o $@ ./satsolversforocaml/src/picosat/backend/PicoSATWrap.cc

_build/zchaff_ocaml_wrapper.o:
	mkdir -p ./_build
	gcc -c -g -I `ocamlfind printconf stdlib` -o $@ ./satsolversforocaml/src/zchaff/backend/zchaff_ocaml_wrapper.cpp

_build/MiniSATWrap.o:
	mkdir -p ./_build
	gcc -D__STDC_LIMIT_MACROS -c -I `ocamlfind printconf stdlib` -I $(MINISAT) -o $@ ./satsolversforocaml/src/minisat/backend/MiniSATWrap.cc

